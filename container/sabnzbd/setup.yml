---

- name: install systemd file for sabnzbd
  template:
    src=../container/sabnzbd/files/sabnzbd.service.j2
    dest=/etc/systemd/system/sabnzbd.service
    owner=root
    group=root
    mode=0755
  register: systemd

- name: reload systemd daemon
  command: systemctl daemon-reload
  when: systemd.changed

- name: install systemd file for sabnzbd data container
  template:
    src=../container/sabnzbd/files/sabnzbd-data.service.j2
    dest=/etc/systemd/system/sabnzbd-data.service
    owner=root
    group=root
    mode=0755
  register: systemd

- name: reload systemd daemon
  command: systemctl daemon-reload
  when: systemd.changed

- name: install systemd file for sabnzbd discovery
  template:
    src=../container/sabnzbd/files/sabnzbd-discovery.service.j2
    dest=/etc/systemd/system/sabnzbd-discovery.service
    owner=root
    group=root
    mode=0755
  register: systemd

- name: reload systemd daemon
  command: systemctl daemon-reload
  when: systemd.changed

- name: pull docker container
  command: docker pull sebastianhutter/sabnzbd

- name: enable sabnzbd services
  service:
    name={{item}}
    enabled=yes
  with_items:
    - sabnzbd
    - sabnzbd-data
    - sabnzbd-discovery