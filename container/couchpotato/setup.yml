---

- name: install systemd file for couchpotato
  template:
    src=../container/couchpotato/files/couchpotato.service.j2
    dest=/etc/systemd/system/couchpotato.service
    owner=root
    group=root
    mode=0755
  register: systemd

- name: reload systemd daemon
  command: systemctl daemon-reload
  when: systemd.changed

- name: install systemd file for couchpotato data container
  template:
    src=../container/couchpotato/files/couchpotato-data.service.j2
    dest=/etc/systemd/system/couchpotato-data.service
    owner=root
    group=root
    mode=0755
  register: systemd

- name: reload systemd daemon
  command: systemctl daemon-reload
  when: systemd.changed

- name: install systemd file for couchpotato discovery
  template:
    src=../container/couchpotato/files/couchpotato-discovery.service.j2
    dest=/etc/systemd/system/couchpotato-discovery.service
    owner=root
    group=root
    mode=0755
  register: systemd

- name: reload systemd daemon
  command: systemctl daemon-reload
  when: systemd.changed

- name: pull docker container
  command: docker pull sebastianhutter/couchpotato

- name: enable couchpotato services
  service:
    name={{item}}
    enabled=yes
  with_items:
    - couchpotato
    - couchpotato-data
    - couchpotato-discovery

